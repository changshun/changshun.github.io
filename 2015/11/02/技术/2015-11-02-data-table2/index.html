<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> data.table Way2 | Changshun的Blog</title><meta name="description" content="data.table Way2 - Changshun"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/casual.css"><link rel="stylesheet" href="/css/semantic.min.css"><link rel="search" type="application/opensearchdescription+xml" href="http://shichangshun.cn/atom.xml" title="Changshun的Blog"></head><body><div class="sidebar"><div class="ui vertical inverted menu"><div class="h100"></div><h3 class="ui inverted aligned icon header"><div class="content"><a href="/" class="title-link">CHANGSHUN的BLOG</a></div></h3><div class="h50"></div><div class="side-nav"><a href="/" target="_self" class="item">HOME<i class="icon home"></i></a><a href="/categories" target="_self" class="item">CATEGORIES<i class="icon categories"></i></a><a href="/about" target="_self" class="item">ABOUT<i class="icon about"></i></a><a href="/archives" target="_self" class="item">ARCHIVES<i class="icon archives"></i></a><a href="/tags" target="_self" class="item">TAGS<i class="icon tags"></i></a><a href="/atom.xml" target="_self" class="item">RSS<i class="icon rss"></i></a></div><div class="item"><div class="ui inverted transparent icon input"><input type="text" placeholder="Search..." class="st-default-search-input"><i class="search icon"></i></div></div><div class="h50"></div></div><div class="h50 mq"><a class="ui teal big label"><i class="content icon"></i></a></div><div class="author-info"><a href="/" class="img-link"><img src="http://i.imgbox.com/v0MVVgnM.jpeg" class="author-photo ui tiny circular image"></a><h4 class="ui aligned icon header"><div class="content">Changshun</div></h4><p class="author-desc">R、Python、数据爱好者 | 量化🐶 | 詹🐶一只</p><div class="social-outer"><div class="social-inner"><a href="https://github.com/changshun" target="_blank" class="social-link"><i class="icon github"></i></a><a href="https://twitter.com/allenstoneshi" target="_blank" class="social-link"><i class="icon twitter"></i></a></div></div></div></div><div class="main"><div class="wrap"><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">data.table Way2</h1><div class="post-info"><div class="post-date"><h6 class="ui header"><i class="calendar icon"></i><div class="content">Nov 2, 2015</div></h6></div></div><div class="post-content"><h1 id="data-table-Way-2"><a href="#data-table-Way-2" class="headerlink" title="data.table Way 2"></a>data.table Way 2</h1><p>继续<a href="http://changshun.github.io/2015/11/02/data-table.html" target="_blank" rel="external">data.table1</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">library(data.table)</div><div class="line">library(ggplot2)</div><div class="line">library(plyr)</div></pre></td></tr></table></figure>
<p>我们继续使用Basketball Reference: boxscore数据和<code>mtcars</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">boxscore &lt;- fread(&quot;/Users/shihchosen/Desktop/boxscore.csv&quot;)</div><div class="line">dtb &lt;- copy(boxscore)</div><div class="line">dtb[,1:2:=NULL]</div><div class="line">dtb[,year:=year(date)]</div><div class="line">head(dtb)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">##          date      game_id team_home_abbr team          player player_id</div><div class="line">## 1: 2012-10-30 201210300CLE            CLE  WAS      A.J. Price priceaj01</div><div class="line">## 2: 2012-10-30 201210300CLE            CLE  WAS    Emeka Okafor okafoem01</div><div class="line">## 3: 2012-10-30 201210300CLE            CLE  WAS    Trevor Ariza arizatr01</div><div class="line">## 4: 2012-10-30 201210300CLE            CLE  WAS    Bradley Beal  bealbr01</div><div class="line">## 5: 2012-10-30 201210300CLE            CLE  WAS   Trevor Booker booketr01</div><div class="line">## 6: 2012-10-30 201210300CLE            CLE  WAS Jordan Crawford crawfjo02</div><div class="line">##    minutes fgm fga 3pm 3pa ftm fta offreb defreb totreb assists steals</div><div class="line">## 1:   29.40   2  13   2   9   1   1      1      1      2       6      0</div><div class="line">## 2:   24.58   4  10   0   0   2   4      5      2      7       0      0</div><div class="line">## 3:   24.58   3   8   2   4   1   2      1      2      3       4      3</div><div class="line">## 4:   21.55   2   8   2   4   2   2      0      3      3       3      1</div><div class="line">## 5:   16.75   2   9   0   1   0   0      1      0      1       1      1</div><div class="line">## 6:   28.70   4  13   0   6   3   4      1      2      3       5      1</div><div class="line">##    blocks turnovers fouls points plusminus year</div><div class="line">## 1:      0         1     1      7       -11 2012</div><div class="line">## 2:      4         1     1     10        -5 2012</div><div class="line">## 3:      2         0     0      9        -9 2012</div><div class="line">## 4:      0         2     1      8       -16 2012</div><div class="line">## 5:      1         4     4      4       -15 2012</div><div class="line">## 6:      1         1     1     11         0 2012</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dtm &lt;- data.table(mtcars)</div><div class="line">head(dtm)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">##     mpg cyl disp  hp drat    wt  qsec vs am gear carb</div><div class="line">## 1: 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</div><div class="line">## 2: 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</div><div class="line">## 3: 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</div><div class="line">## 4: 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</div><div class="line">## 5: 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</div><div class="line">## 6: 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</div></pre></td></tr></table></figure>
<h2 id="set-族"><a href="#set-族" class="headerlink" title="set() 族"></a><code>set()</code> 族</h2><table>
<thead>
<tr>
<th>set family</th>
<th>usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>set()</code></td>
<td><code>:=</code>的循环版本</td>
</tr>
<tr>
<td><code>setnames()</code></td>
<td>设置或更改列名</td>
</tr>
<tr>
<td><code>setorder()</code></td>
<td>更改行的顺序</td>
</tr>
<tr>
<td><code>setcolorder()</code></td>
<td>更改行的顺序</td>
</tr>
<tr>
<td><code>setkey()</code></td>
<td>设置<code>data.table</code>中的key</td>
</tr>
</tbody>
</table>
<h3 id="set"><a href="#set" class="headerlink" title="set()"></a>set()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dtb1 &lt;- copy(dtb)</div><div class="line">set(dtb1, j = which(colnames(dtb)==&apos;plusminus&apos;), value = 1)</div><div class="line">head(dtb1)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">##          date      game_id team_home_abbr team          player player_id</div><div class="line">## 1: 2012-10-30 201210300CLE            CLE  WAS      A.J. Price priceaj01</div><div class="line">## 2: 2012-10-30 201210300CLE            CLE  WAS    Emeka Okafor okafoem01</div><div class="line">## 3: 2012-10-30 201210300CLE            CLE  WAS    Trevor Ariza arizatr01</div><div class="line">## 4: 2012-10-30 201210300CLE            CLE  WAS    Bradley Beal  bealbr01</div><div class="line">## 5: 2012-10-30 201210300CLE            CLE  WAS   Trevor Booker booketr01</div><div class="line">## 6: 2012-10-30 201210300CLE            CLE  WAS Jordan Crawford crawfjo02</div><div class="line">##    minutes fgm fga 3pm 3pa ftm fta offreb defreb totreb assists steals</div><div class="line">## 1:   29.40   2  13   2   9   1   1      1      1      2       6      0</div><div class="line">## 2:   24.58   4  10   0   0   2   4      5      2      7       0      0</div><div class="line">## 3:   24.58   3   8   2   4   1   2      1      2      3       4      3</div><div class="line">## 4:   21.55   2   8   2   4   2   2      0      3      3       3      1</div><div class="line">## 5:   16.75   2   9   0   1   0   0      1      0      1       1      1</div><div class="line">## 6:   28.70   4  13   0   6   3   4      1      2      3       5      1</div><div class="line">##    blocks turnovers fouls points plusminus year</div><div class="line">## 1:      0         1     1      7         1 2012</div><div class="line">## 2:      4         1     1     10         1 2012</div><div class="line">## 3:      2         0     0      9         1 2012</div><div class="line">## 4:      0         2     1      8         1 2012</div><div class="line">## 5:      1         4     4      4         1 2012</div><div class="line">## 6:      1         1     1     11         1 2012</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set(dtb1, j = which(colnames(dtb)==&apos;plusminus&apos;), value = dtb$plusminus)</div></pre></td></tr></table></figure>
<p>创建一个<code>data.table</code>, 随机将每行的5个数字变成10</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">temp &lt;- data.table(A = sample(1:9),</div><div class="line">                   B = sample(1:9),</div><div class="line">                   C = sample(1:9),</div><div class="line">                   D = sample(1:9),</div><div class="line">                   E = sample(1:9))</div><div class="line"></div><div class="line"># for each row, randomly change 3 values to 10 </div><div class="line">for (i in 1:9) set(temp, i, sample(5, 3), 10)</div><div class="line">temp</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">##     A  B  C  D  E</div><div class="line">## 1: 10  7 10 10  3</div><div class="line">## 2: 10 10 10  9  9</div><div class="line">## 3: 10  9  2 10 10</div><div class="line">## 4:  4  2 10 10 10</div><div class="line">## 5:  6 10 10  8 10</div><div class="line">## 6:  7 10 10 10  8</div><div class="line">## 7: 10  6 10 10  1</div><div class="line">## 8:  9  1 10 10 10</div><div class="line">## 9:  3  5 10 10 10</div></pre></td></tr></table></figure>
<h3 id="setnames"><a href="#setnames" class="headerlink" title="setnames()"></a><code>setnames()</code></h3><p>把<code>temp</code>的列名更改为<code>列_*</code>的格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># setnames(x, old, new)</div><div class="line">setnames(temp, names(temp), paste0(&apos;列_&apos;, names(temp)))</div><div class="line">head(temp, 3)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">##    列_A 列_B 列_C 列_D 列_E</div><div class="line">## 1:   10    7   10   10    3</div><div class="line">## 2:   10   10   10    9    9</div><div class="line">## 3:   10    9    2   10   10</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#把`temp`的列名更改为`Col_*`的格式：</div><div class="line">setnames(temp, gsub(&apos;^列_&apos;, &apos;Col_&apos;, names(temp)))</div><div class="line">head(temp, 3)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">##    Col_A Col_B Col_C Col_D Col_E</div><div class="line">## 1:    10     7    10    10     3</div><div class="line">## 2:    10    10    10     9     9</div><div class="line">## 3:    10     9     2    10    10</div></pre></td></tr></table></figure>
<h3 id="setorder-and-setcolorder"><a href="#setorder-and-setcolorder" class="headerlink" title="setorder() and setcolorder()"></a><code>setorder()</code> and <code>setcolorder()</code></h3><p>按照年份和得分排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setorder(dtb1, year, -points)</div><div class="line">dtb1[, head(.SD), by=year]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div></pre></td><td class="code"><pre><div class="line">##     year       date      game_id team_home_abbr team           player</div><div class="line">##  1: 2004 2004-12-18 200412180MIL            MIL  PHI    Allen Iverson</div><div class="line">##  2: 2004 2004-12-02 200412020DAL            DAL  DAL    Dirk Nowitzki</div><div class="line">##  3: 2004 2004-12-20 200412200PHI            PHI  PHI    Allen Iverson</div><div class="line">##  4: 2004 2004-12-02 200412020DAL            DAL  HOU    Tracy McGrady</div><div class="line">##  5: 2004 2004-12-28 200412280LAL            LAL  LAL      Kobe Bryant</div><div class="line">##  6: 2004 2004-11-24 200411240CLE            CLE  CLE     LeBron James</div><div class="line">##  7: 2005 2005-12-20 200512200LAL            LAL  LAL      Kobe Bryant</div><div class="line">##  8: 2005 2005-02-12 200502120PHI            PHI  PHI    Allen Iverson</div><div class="line">##  9: 2005 2005-03-20 200503200TOR            TOR  CLE     LeBron James</div><div class="line">## 10: 2005 2005-01-04 200501040IND            IND  IND  Jermaine O&apos;Neal</div><div class="line">## 11: 2005 2005-01-14 200501140NOH            NOH  POR Damon Stoudamire</div><div class="line">## 12: 2005 2005-12-23 200512230ATL            ATL  PHI    Allen Iverson</div><div class="line">## 13: 2006 2006-01-22 200601220LAL            LAL  LAL      Kobe Bryant</div><div class="line">## 14: 2006 2006-12-17 200612170LAL            LAL  WAS   Gilbert Arenas</div><div class="line">## 15: 2006 2006-12-29 200612290CHA            CHA  LAL      Kobe Bryant</div><div class="line">## 16: 2006 2006-11-11 200611110MIL            MIL  MIL     Michael Redd</div><div class="line">## 17: 2006 2006-12-22 200612220PHO            PHO  WAS   Gilbert Arenas</div><div class="line">## 18: 2006 2006-12-15 200612150LAL            LAL  LAL      Kobe Bryant</div><div class="line">## 19: 2007 2007-03-16 200703160LAL            LAL  LAL      Kobe Bryant</div><div class="line">## 20: 2007 2007-03-22 200703220MEM            MEM  LAL      Kobe Bryant</div><div class="line">## 21: 2007 2007-01-12 200701120OKC            OKC  OKC        Ray Allen</div><div class="line">## 22: 2007 2007-03-30 200703300LAL            LAL  LAL      Kobe Bryant</div><div class="line">## 23: 2007 2007-01-26 200701260NYK            NYK  NYK   Jamal Crawford</div><div class="line">## 24: 2007 2007-03-04 200703040MIL            MIL  MIL     Michael Redd</div><div class="line">## 25: 2008 2008-11-05 200811050MIN            MIN  SAS      Tony Parker</div><div class="line">## 26: 2008 2008-03-28 200803280LAL            LAL  LAL      Kobe Bryant</div><div class="line">## 27: 2008 2008-12-18 200812180POR            POR  POR      Brandon Roy</div><div class="line">## 28: 2008 2008-03-02 200803020LAL            LAL  LAL      Kobe Bryant</div><div class="line">## 29: 2008 2008-01-15 200801150MEM            MEM  CLE     LeBron James</div><div class="line">## 30: 2008 2008-12-20 200812200CHA            CHA  GSW   Jamal Crawford</div><div class="line">## 31: 2009 2009-02-02 200902020NYK            NYK  LAL      Kobe Bryant</div><div class="line">## 32: 2009 2009-11-14 200911140MIL            MIL  MIL Brandon Jennings</div><div class="line">## 33: 2009 2009-02-20 200902200MIL            MIL  CLE     LeBron James</div><div class="line">## 34: 2009 2009-04-12 200904120MIA            MIA  MIA      Dwyane Wade</div><div class="line">## 35: 2009 2009-02-04 200902040NYK            NYK  CLE     LeBron James</div><div class="line">## 36: 2009 2009-03-13 200903130SAC            SAC  CLE     LeBron James</div><div class="line">## 37: 2010 2010-01-30 201001300DAL            DAL  POR     Andre Miller</div><div class="line">## 38: 2010 2010-02-08 201002080ORL            ORL  ORL     Vince Carter</div><div class="line">## 39: 2010 2010-02-06 201002060CLE            CLE  CLE     LeBron James</div><div class="line">## 40: 2010 2010-10-27 201010270GSW            GSW  GSW      Monta Ellis</div><div class="line">## 41: 2010 2010-11-09 201011090MIA            MIA  UTA     Paul Millsap</div><div class="line">## 42: 2010 2010-02-03 201002030DAL            DAL  GSW      Monta Ellis</div><div class="line">## 43: 2011 2011-02-03 201102030ORL            ORL  MIA     LeBron James</div><div class="line">## 44: 2011 2011-02-07 201102070DEN            DEN  DEN  Carmelo Anthony</div><div class="line">## 45: 2011 2011-05-17 201105170DAL            DAL  DAL    Dirk Nowitzki</div><div class="line">## 46: 2011 2011-01-17 201101170LAC            LAC  LAC    Blake Griffin</div><div class="line">## 47: 2011 2011-01-26 201101260MIN            MIN  OKC     Kevin Durant</div><div class="line">## 48: 2011 2011-04-16 201104160ORL            ORL  ORL    Dwight Howard</div><div class="line">## 49: 2012 2012-03-04 201203040CHA            CHA  BRK   Deron Williams</div><div class="line">## 50: 2012 2012-02-19 201202190OKC            OKC  OKC     Kevin Durant</div><div class="line">## 51: 2012 2012-03-23 201203230OKC            OKC  MIN       Kevin Love</div><div class="line">## 52: 2012 2012-01-10 201201100LAL            LAL  LAL      Kobe Bryant</div><div class="line">## 53: 2012 2012-02-07 201202070GSW            GSW  GSW      Monta Ellis</div><div class="line">## 54: 2012 2012-11-02 201211020ATL            ATL  HOU     James Harden</div><div class="line">## 55: 2013 2013-02-27 201302270NYK            NYK  GSW    Stephen Curry</div><div class="line">## 56: 2013 2013-01-18 201301180DAL            DAL  OKC     Kevin Durant</div><div class="line">## 57: 2013 2013-04-02 201304020MIA            MIA  NYK  Carmelo Anthony</div><div class="line">## 58: 2013 2013-03-25 201303250WAS            WAS  WAS        John Wall</div><div class="line">## 59: 2013 2013-04-10 201304100POR            POR  LAL      Kobe Bryant</div><div class="line">## 60: 2013 2013-04-12 201304120LAL            LAL  GSW    Stephen Curry</div><div class="line">##     year       date      game_id team_home_abbr team           player</div><div class="line">##     player_id minutes fgm fga 3pm 3pa ftm fta offreb defreb totreb assists</div><div class="line">##  1: iversal01   40.00  17  29   4   7  16  21      2      6      8       5</div><div class="line">##  2: nowitdi01   49.00  15  32   2   5  21  22      4     12     16       2</div><div class="line">##  3: iversal01   46.00  18  31   4   6  11  17      0      1      1       6</div><div class="line">##  4: mcgratr01   49.00  19  36   6  13   4   7      5      4      9       9</div><div class="line">##  5: bryanko01   46.00  14  26   4   7  16  18      0      2      2       4</div><div class="line">##  6: jamesle01   38.00  15  22   2   3  11  12      3      3      6       5</div><div class="line">##  7: bryanko01   32.88  18  31   4  10  22  25      3      5      8       0</div><div class="line">##  8: iversal01   42.00  17  36   2   5  24  27      1      3      4       6</div><div class="line">##  9: jamesle01   48.00  18  36   6  12  14  15      2      8     10       5</div><div class="line">## 10: onealje01   36.00  18  28   0   0  19  25      3      8     11       3</div><div class="line">## 11: stoudda01   43.00  20  32   8  16   6   6      0      0      0       1</div><div class="line">## 12: iversal01   44.50  17  31   0   1  19  21      0      6      6       5</div><div class="line">## 13: bryanko01   41.93  28  46   7  13  18  20      2      4      6       2</div><div class="line">## 14: arenagi01   49.00  17  32   5  12  21  27      0      8      8       8</div><div class="line">## 15: bryanko01   54.47  22  45   4  11  10  12      0      5      5       4</div><div class="line">## 16:  reddmi01   45.73  18  32   6  12  15  17      0      2      2       0</div><div class="line">## 17: arenagi01   47.57  21  37   6  12   6   6      0      3      3       4</div><div class="line">## 18: bryanko01   54.02  17  38   5   8  14  16      0     10     10       8</div><div class="line">## 19: bryanko01   49.97  23  39   8  12  11  12      1      6      7       3</div><div class="line">## 20: bryanko01   45.18  20  37   3   7  17  18      2      3      5       4</div><div class="line">## 21: allenra02   43.12  17  32   8  12  12  12      3      7     10       5</div><div class="line">## 22: bryanko01   47.57  19  44   3   9  12  14      1      1      2       2</div><div class="line">## 23: crawfja01   39.48  20  30   8  10   4   4      2      1      3       1</div><div class="line">## 24:  reddmi01   43.63  18  32   8  13   8   9      1      2      3       2</div><div class="line">## 25: parketo01   50.53  22  36   2   3   9  10      0      7      7      10</div><div class="line">## 26: bryanko01   41.87  19  37   9  17   6   7      2      8     10       1</div><div class="line">## 27:   roybr01   43.82  14  27   5   7  19  21      1      4      5       6</div><div class="line">## 28: bryanko01   51.40  15  27   2   3  20  27      1     10     11       4</div><div class="line">## 29: jamesle01   47.17  18  28   6  12   9  16      3      5      8       9</div><div class="line">## 30: crawfja01   45.85  14  26   5   8  17  18      0      2      2       5</div><div class="line">## 31: bryanko01   36.80  19  31   3   6  20  20      0      0      0       3</div><div class="line">## 32: jennibr01   40.72  21  34   7   8   6   8      1      4      5       5</div><div class="line">## 33: jamesle01   40.07  16  29   8  11  15  22      1      4      5       9</div><div class="line">## 34:  wadedw01   39.28  19  30   6  12  11  13      2      7      9       4</div><div class="line">## 35: jamesle01   44.05  17  33   2   7  16  19      0      9      9      11</div><div class="line">## 36: jamesle01   46.98  16  30   4  11  15  17      0      4      4       9</div><div class="line">## 37: millean02   42.23  22  31   1   1   7   8      1      4      5       2</div><div class="line">## 38: cartevi01   38.05  19  27   6  10   4   4      0      7      7       2</div><div class="line">## 39: jamesle01   43.85  17  31   6  12   7   7      1      7      8       8</div><div class="line">## 40: ellismo01   39.75  18  24   1   2   9  12      0      3      3       2</div><div class="line">## 41: millspa01   43.45  19  28   3   3   5   7      4      5      9       1</div><div class="line">## 42: ellismo01   40.85  17  23   4   6   8  13      3      1      4       2</div><div class="line">## 43: jamesle01   42.65  17  25   3   5  14  17      2      9     11       8</div><div class="line">## 44: anthoca01   39.47  16  24   2   3  16  18      1     10     11       0</div><div class="line">## 45: nowitdi01   40.90  12  15   0   0  24  24      0      6      6       4</div><div class="line">## 46: griffbl01   36.93  19  24   0   0   9  11      3     11     14       3</div><div class="line">## 47: duranke01   49.83  15  28   4   8  13  14      2     16     18       2</div><div class="line">## 48: howardw01   45.80  16  23   0   1  14  22      6     13     19       1</div><div class="line">## 49: willide01   37.75  16  29   4  11  21  21      1      5      6       7</div><div class="line">## 50: duranke01   45.45  19  28   5   6   8  10      2      6      8       3</div><div class="line">## 51:  loveke01   49.32  16  27   7  11  12  16      6      8     14       0</div><div class="line">## 52: bryanko01   39.12  18  31   0   3  12  13      0      5      5       3</div><div class="line">## 53: ellismo01   41.75  18  29   3   6   9  10      1      6      7       2</div><div class="line">## 54: hardeja01   39.82  14  19   2   4  15  17      1      6      7       2</div><div class="line">## 55: curryst01   48.00  18  28  11  13   7   7      0      6      6       7</div><div class="line">## 56: duranke01   49.67  13  31   5   9  21  21      0      9      9       1</div><div class="line">## 57: anthoca01   40.33  18  26   7  10   7   8      0      2      2       2</div><div class="line">## 58:  walljo01   44.55  13  22   2   4  19  24      0      7      7       8</div><div class="line">## 59: bryanko01   48.00  14  27   1   5  18  18      0      8      8       5</div><div class="line">## 60: curryst01   44.28  17  31   9  15   4   4      3      3      6       9</div><div class="line">##     player_id minutes fgm fga 3pm 3pa ftm fta offreb defreb totreb assists</div><div class="line">##     steals blocks turnovers fouls points plusminus</div><div class="line">##  1:      2      0         3     0     54        25</div><div class="line">##  2:      3      4         1     2     53        12</div><div class="line">##  3:      7      0         7     6     51         0</div><div class="line">##  4:      2      3         2     3     48         0</div><div class="line">##  5:      2      0         5     2     48        21</div><div class="line">##  6:      3      1         3     3     43        12</div><div class="line">##  7:      3      0         2     3     62        35</div><div class="line">##  8:      5      1         3     1     60        27</div><div class="line">##  9:      2      0         4     0     56        -7</div><div class="line">## 10:      0      2         3     3     55        22</div><div class="line">## 11:      1      0         0     3     54        -7</div><div class="line">## 12:      2      0         0     0     53        -5</div><div class="line">## 13:      3      1         3     1     81        25</div><div class="line">## 14:      2      0         3     3     60        10</div><div class="line">## 15:      0      0         4     6     58         5</div><div class="line">## 16:      3      1         3     2     57         2</div><div class="line">## 17:      1      0         4     5     54        12</div><div class="line">## 18:      2      1         5     1     53        20</div><div class="line">## 19:      3      0         2     3     65         4</div><div class="line">## 20:      0      0         2     4     60         2</div><div class="line">## 21:      1      0         2     2     54        10</div><div class="line">## 22:      0      0         3     2     53         1</div><div class="line">## 23:      2      0         3     2     52        27</div><div class="line">## 24:      3      0         4     2     52       -12</div><div class="line">## 25:      0      0         4     0     55         7</div><div class="line">## 26:      3      0         1     4     53         1</div><div class="line">## 27:      0      1         0     1     52        12</div><div class="line">## 28:      1      2         5     2     52         4</div><div class="line">## 29:      3      1         4     1     51        10</div><div class="line">## 30:      0      1         1     2     50        15</div><div class="line">## 31:      0      1         2     1     61        19</div><div class="line">## 32:      0      0         4     1     55        11</div><div class="line">## 33:      0      0         6     3     55        13</div><div class="line">## 34:      0      1         3     3     55        24</div><div class="line">## 35:      0      2         3     1     52         7</div><div class="line">## 36:      2      3         3     2     51         6</div><div class="line">## 37:      2      0         2     2     52         4</div><div class="line">## 38:      0      0         2     5     48        19</div><div class="line">## 39:      5      0         5     2     47         4</div><div class="line">## 40:      2      0         1     4     46         9</div><div class="line">## 41:      1      1         1     4     46         2</div><div class="line">## 42:      1      1         7     5     46        -9</div><div class="line">## 43:      1      1         3     2     51         2</div><div class="line">## 44:      1      3         4     2     50        -3</div><div class="line">## 45:      0      4         2     3     48        12</div><div class="line">## 46:      0      1         4     3     47        17</div><div class="line">## 47:      2      2         2     2     47        -3</div><div class="line">## 48:      0      1         8     5     46       -10</div><div class="line">## 49:      1      1         5     2     57        11</div><div class="line">## 50:      4      0         5     1     51        19</div><div class="line">## 51:      1      1         4     3     51         4</div><div class="line">## 52:      3      0         2     2     48        16</div><div class="line">## 53:      2      1         3     2     48         5</div><div class="line">## 54:      0      0         5     3     45        17</div><div class="line">## 55:      3      0         4     3     54        -4</div><div class="line">## 56:      2      0         4     2     52        -1</div><div class="line">## 57:      1      1         0     3     50        15</div><div class="line">## 58:      1      1         2     2     47        26</div><div class="line">## 59:      3      4         1     4     47         7</div><div class="line">## 60:      3      0         1     3     47         3</div><div class="line">##     steals blocks turnovers fouls points plusminus</div></pre></td></tr></table></figure>
<p>按照字母表为列名排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setcolorder(dtb1, sort(names(dtb)))</div><div class="line">head(dtb1)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">##    3pa 3pm assists blocks       date defreb fga fgm fouls fta ftm</div><div class="line">## 1:   7   4       5      0 2004-12-18      6  29  17     0  21  16</div><div class="line">## 2:   5   2       2      4 2004-12-02     12  32  15     2  22  21</div><div class="line">## 3:   6   4       6      0 2004-12-20      1  31  18     6  17  11</div><div class="line">## 4:  13   6       9      3 2004-12-02      4  36  19     3   7   4</div><div class="line">## 5:   7   4       4      0 2004-12-28      2  26  14     2  18  16</div><div class="line">## 6:   3   2       5      1 2004-11-24      3  22  15     3  12  11</div><div class="line">##         game_id minutes offreb        player player_id plusminus points</div><div class="line">## 1: 200412180MIL      40      2 Allen Iverson iversal01        25     54</div><div class="line">## 2: 200412020DAL      49      4 Dirk Nowitzki nowitdi01        12     53</div><div class="line">## 3: 200412200PHI      46      0 Allen Iverson iversal01         0     51</div><div class="line">## 4: 200412020DAL      49      5 Tracy McGrady mcgratr01         0     48</div><div class="line">## 5: 200412280LAL      46      0   Kobe Bryant bryanko01        21     48</div><div class="line">## 6: 200411240CLE      38      3  LeBron James jamesle01        12     43</div><div class="line">##    steals team team_home_abbr totreb turnovers year</div><div class="line">## 1:      2  PHI            MIL      8         3 2004</div><div class="line">## 2:      3  DAL            DAL     16         1 2004</div><div class="line">## 3:      7  PHI            PHI      1         7 2004</div><div class="line">## 4:      2  HOU            DAL      9         2 2004</div><div class="line">## 5:      2  LAL            LAL      2         5 2004</div><div class="line">## 6:      3  CLE            CLE      6         3 2004</div></pre></td></tr></table></figure>
<h3 id="setkey"><a href="#setkey" class="headerlink" title="setkey()"></a><code>setkey()</code></h3><p>把<code>character</code>类型的column设为<code>key</code></p>
<blockquote>
<p>setkey() sorts a data.table and marks it as sorted (with an attribute sorted). The sorted columns are the key. The key can be any columns in any order. The columns are sorted in ascending order always.</p>
<p>setkey reorders (or sorts) the rows of a data.table by the columns provided. In versions 1.9+, for integer columns… It is extremely fast, but is limited by the range of integer values being \&lt;= 1e5</p>
</blockquote>
<p>查询球员各年平均数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">player.query &lt;- function(name,...)&#123;</div><div class="line">dtb.key &lt;- copy(dtb)</div><div class="line">setkey(dtb.key, player)</div><div class="line">data&lt;-dtb.key[name][, lapply(.SD, function(x)round(mean(x),2)), .SDcols=7:23, by=.(year, player)][order(player, year)]</div><div class="line">return(data)&#125;</div><div class="line"># 查询 Kobe Bryant</div><div class="line">player.query(&quot;Kobe Bryant&quot;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">##     year      player minutes   fgm   fga  3pm  3pa  ftm   fta offreb</div><div class="line">##  1: 2004 Kobe Bryant   43.70  8.48 21.22 1.89 5.74 9.56 11.85   1.41</div><div class="line">##  2: 2005 Kobe Bryant   39.33  9.97 22.28 1.69 5.15 7.76  9.49   1.43</div><div class="line">##  3: 2006 Kobe Bryant   41.05 11.47 24.67 2.42 6.66 8.17  9.51   0.63</div><div class="line">##  4: 2007 Kobe Bryant   39.92 10.43 23.05 1.80 5.31 8.36  9.58   1.04</div><div class="line">##  5: 2008 Kobe Bryant   38.96  9.81 20.79 1.57 4.50 7.28  8.71   1.15</div><div class="line">##  6: 2009 Kobe Bryant   38.03 10.42 22.24 1.46 4.28 6.43  7.49   1.08</div><div class="line">##  7: 2010 Kobe Bryant   37.30  9.09 20.50 1.64 4.71 6.05  7.45   0.98</div><div class="line">##  8: 2011 Kobe Bryant   34.62  9.03 19.92 1.33 4.27 5.58  6.77   0.97</div><div class="line">##  9: 2012 Kobe Bryant   38.91 10.21 22.99 1.74 5.31 6.80  8.04   1.09</div><div class="line">## 10: 2013 Kobe Bryant   38.60  8.94 19.77 1.40 4.83 6.35  7.65   0.83</div><div class="line">##     defreb totreb assists steals blocks turnovers fouls points plusminus</div><div class="line">##  1:   5.67   7.07    7.07   1.37   1.15      4.67  2.78  28.41      3.11</div><div class="line">##  2:   3.85   5.28    4.93   1.22   0.57      3.34  2.68  29.40     -1.50</div><div class="line">##  3:   4.64   5.27    4.81   1.84   0.30      3.43  3.08  33.52      3.13</div><div class="line">##  4:   5.02   6.06    5.20   1.65   0.54      3.35  2.36  31.01      1.42</div><div class="line">##  5:   4.80   5.94    5.20   1.65   0.41      2.97  2.75  28.47      7.36</div><div class="line">##  6:   4.29   5.37    5.08   1.69   0.52      2.70  2.46  28.75      8.10</div><div class="line">##  7:   4.27   5.24    5.08   1.24   0.33      3.26  2.57  25.88      4.26</div><div class="line">##  8:   4.08   5.05    4.80   1.23   0.20      3.03  2.14  24.97      5.28</div><div class="line">##  9:   4.14   5.23    4.54   1.28   0.28      3.39  2.15  28.96      2.37</div><div class="line">## 10:   4.85   5.69    6.71   1.29   0.33      3.77  1.92  25.62     -0.58</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">player.query(&quot;Jeremy Lin&quot;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">##    year     player minutes  fgm   fga  3pm  3pa  ftm  fta offreb defreb</div><div class="line">## 1: 2010 Jeremy Lin    8.55 0.71  2.24 0.00 0.12 0.53 0.76   0.29   0.47</div><div class="line">## 2: 2011 Jeremy Lin    9.74 1.07  2.47 0.07 0.20 0.80 0.93   0.53   0.93</div><div class="line">## 3: 2012 Jeremy Lin   30.91 4.98 11.24 0.76 2.59 3.33 4.14   0.52   3.03</div><div class="line">## 4: 2013 Jeremy Lin   31.09 4.71 10.78 1.18 3.29 2.76 3.58   0.29   2.20</div><div class="line">##    totreb assists steals blocks turnovers fouls points plusminus</div><div class="line">## 1:   0.76    0.94   1.12   0.41      0.65  0.88   1.94     -0.53</div><div class="line">## 2:   1.47    1.80   1.00   0.13      0.60  1.33   3.00      1.00</div><div class="line">## 3:   3.56    6.56   1.78   0.38      3.41  2.38  14.06      3.14</div><div class="line">## 4:   2.49    5.58   1.42   0.27      2.78  2.51  13.36      0.24</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">player.query(c(&quot;Kobe Bryant&quot;, &quot;LeBron James&quot;))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">##     year       player minutes   fgm   fga  3pm  3pa  ftm   fta offreb</div><div class="line">##  1: 2004  Kobe Bryant   43.70  8.48 21.22 1.89 5.74 9.56 11.85   1.41</div><div class="line">##  2: 2005  Kobe Bryant   39.33  9.97 22.28 1.69 5.15 7.76  9.49   1.43</div><div class="line">##  3: 2006  Kobe Bryant   41.05 11.47 24.67 2.42 6.66 8.17  9.51   0.63</div><div class="line">##  4: 2007  Kobe Bryant   39.92 10.43 23.05 1.80 5.31 8.36  9.58   1.04</div><div class="line">##  5: 2008  Kobe Bryant   38.96  9.81 20.79 1.57 4.50 7.28  8.71   1.15</div><div class="line">##  6: 2009  Kobe Bryant   38.03 10.42 22.24 1.46 4.28 6.43  7.49   1.08</div><div class="line">##  7: 2010  Kobe Bryant   37.30  9.09 20.50 1.64 4.71 6.05  7.45   0.98</div><div class="line">##  8: 2011  Kobe Bryant   34.62  9.03 19.92 1.33 4.27 5.58  6.77   0.97</div><div class="line">##  9: 2012  Kobe Bryant   38.91 10.21 22.99 1.74 5.31 6.80  8.04   1.09</div><div class="line">## 10: 2013  Kobe Bryant   38.60  8.94 19.77 1.40 4.83 6.35  7.65   0.83</div><div class="line">## 11: 2004 LeBron James   40.86  9.07 18.66 0.93 2.59 5.34  7.03   1.31</div><div class="line">## 12: 2005 LeBron James   42.61 10.46 21.95 1.57 4.49 6.85  9.06   1.18</div><div class="line">## 13: 2006 LeBron James   42.69 10.84 22.78 1.56 4.59 7.10  9.88   1.15</div><div class="line">## 14: 2007 LeBron James   41.48  9.72 21.05 1.18 4.09 6.64  9.34   1.23</div><div class="line">## 15: 2008 LeBron James   39.67 10.17 21.04 1.46 4.81 7.55 10.27   1.62</div><div class="line">## 16: 2009 LeBron James   38.79 10.06 20.50 1.83 5.03 7.82 10.09   1.23</div><div class="line">## 17: 2010 LeBron James   39.00  9.33 18.92 1.59 4.68 7.63 10.05   0.86</div><div class="line">## 18: 2011 LeBron James   40.90 10.00 19.27 1.09 3.40 6.20  8.19   1.34</div><div class="line">## 19: 2012 LeBron James   38.82 10.16 19.37 1.05 2.99 5.98  7.98   1.65</div><div class="line">## 20: 2013 LeBron James   38.98  9.74 17.77 1.41 3.63 5.81  7.53   1.36</div><div class="line">##     defreb totreb assists steals blocks turnovers fouls points plusminus</div><div class="line">##  1:   5.67   7.07    7.07   1.37   1.15      4.67  2.78  28.41      3.11</div><div class="line">##  2:   3.85   5.28    4.93   1.22   0.57      3.34  2.68  29.40     -1.50</div><div class="line">##  3:   4.64   5.27    4.81   1.84   0.30      3.43  3.08  33.52      3.13</div><div class="line">##  4:   5.02   6.06    5.20   1.65   0.54      3.35  2.36  31.01      1.42</div><div class="line">##  5:   4.80   5.94    5.20   1.65   0.41      2.97  2.75  28.47      7.36</div><div class="line">##  6:   4.29   5.37    5.08   1.69   0.52      2.70  2.46  28.75      8.10</div><div class="line">##  7:   4.27   5.24    5.08   1.24   0.33      3.26  2.57  25.88      4.26</div><div class="line">##  8:   4.08   5.05    4.80   1.23   0.20      3.03  2.14  24.97      5.28</div><div class="line">##  9:   4.14   5.23    4.54   1.28   0.28      3.39  2.15  28.96      2.37</div><div class="line">## 10:   4.85   5.69    6.71   1.29   0.33      3.77  1.92  25.62     -0.58</div><div class="line">## 11:   5.66   6.97    7.17   2.48   0.86      3.24  1.83  24.41      4.59</div><div class="line">## 12:   5.91   7.09    6.67   1.95   0.67      3.34  2.04  29.33      2.29</div><div class="line">## 13:   6.19   7.34    6.65   1.44   0.77      3.55  2.35  30.33      1.95</div><div class="line">## 14:   5.89   7.13    6.82   1.74   0.75      3.16  2.18  27.25      4.08</div><div class="line">## 15:   6.03   7.66    6.87   1.86   1.13      3.30  2.15  29.35      5.74</div><div class="line">## 16:   6.69   7.93    7.71   1.54   1.00      3.28  1.76  29.77      8.92</div><div class="line">## 17:   6.54   7.40    8.23   1.62   0.94      3.51  1.76  27.89      8.18</div><div class="line">## 18:   6.77   8.11    6.54   1.74   0.96      3.36  2.19  27.29      5.77</div><div class="line">## 19:   6.81   8.46    6.28   1.75   0.77      3.31  1.60  27.36      7.35</div><div class="line">## 20:   6.61   7.97    7.14   1.79   0.86      3.06  1.60  26.71      9.69</div></pre></td></tr></table></figure>
<p>查询每天所有球员的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">date.query &lt;- function(date,...)&#123;</div><div class="line">dtb.key &lt;- copy(dtb)</div><div class="line">setkey(dtb.key, date)</div><div class="line">data&lt;-dtb.key[date][, lapply(.SD, function(x)round(mean(x),2)), .SDcols=7:23, by=.(date, player)]</div><div class="line">return(data)&#125;</div></pre></td></tr></table></figure>
<p>也可以把<code>numeric</code>类型的column设为<code>key</code><br>查询盖帽数为<code>10</code>的球员</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dtb.key &lt;- copy(dtb)</div><div class="line">setkey(dtb.key,blocks)</div><div class="line">dtb.key[J(10)][,.(date, player, blocks)]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">##          date           player blocks</div><div class="line">## 1: 2012-11-30    Larry Sanders     10</div><div class="line">## 2: 2012-02-01      Serge Ibaka     10</div><div class="line">## 3: 2012-02-09      Serge Ibaka     10</div><div class="line">## 4: 2012-04-29     Andrew Bynum     10</div><div class="line">## 5: 2008-11-12    Dwight Howard     10</div><div class="line">## 6: 2007-12-26     Marcus Camby     10</div><div class="line">## 7: 2007-01-12     Emeka Okafor     10</div><div class="line">## 8: 2006-03-25 Andrei Kirilenko     10</div><div class="line">## 9: 2004-12-18       Josh Smith     10</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># OR</div><div class="line">dtb.key[.(12)][,.(date, player, blocks)]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">##          date       player blocks</div><div class="line">## 1: 2011-03-15 JaVale McGee     12</div></pre></td></tr></table></figure>
<p>也可以设置多个<code>key</code><br>调出LeBron James在骑士的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setkey(dtb.key, player, team)</div><div class="line">dtb.key[.(&apos;LeBron James&apos;, &quot;CLE&quot;)]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">##            date      game_id team_home_abbr team       player player_id</div><div class="line">##   1: 2009-10-28 200910280TOR            TOR  CLE LeBron James jamesle01</div><div class="line">##   2: 2009-10-31 200910310CLE            CLE  CLE LeBron James jamesle01</div><div class="line">##   3: 2009-11-03 200911030CLE            CLE  CLE LeBron James jamesle01</div><div class="line">##   4: 2009-11-06 200911060NYK            NYK  CLE LeBron James jamesle01</div><div class="line">##   5: 2009-11-11 200911110ORL            ORL  CLE LeBron James jamesle01</div><div class="line">##  ---                                                                   </div><div class="line">## 536: 2010-02-18 201002180CLE            CLE  CLE LeBron James jamesle01</div><div class="line">## 537: 2010-04-17 201004170CLE            CLE  CLE LeBron James jamesle01</div><div class="line">## 538: 2008-11-07 200811070CLE            CLE  CLE LeBron James jamesle01</div><div class="line">## 539: 2007-11-04 200711040PHO            PHO  CLE LeBron James jamesle01</div><div class="line">## 540: 2006-02-15 200602150BOS            BOS  CLE LeBron James jamesle01</div><div class="line">##      minutes fgm fga 3pm 3pa ftm fta offreb defreb totreb assists steals</div><div class="line">##   1:   39.78   7  19   1   5   8  14      2      9     11      12      2</div><div class="line">##   2:   37.23   5  11   0   1   4   6      1      6      7       9      0</div><div class="line">##   3:   35.98   7  16   2   7  11  13      3      5      8       6      3</div><div class="line">##   4:   35.62  12  17   2   4   7   9      0      8      8       9      3</div><div class="line">##   5:   39.12  13  23   2   3   8   9      2      6      8       4      1</div><div class="line">##  ---                                                                    </div><div class="line">## 536:   47.00  15  33   1   9  12  17      1     12     13      15      2</div><div class="line">## 537:   40.23   9  19   0   1   6   7      0      6      6       5      1</div><div class="line">## 538:   39.33  11  24   1   6   4   7      2      7      9       8      1</div><div class="line">## 539:   43.22  11  26   3   5   2   2      1      4      5       8      2</div><div class="line">## 540:   53.92  16  32   0   5  11  15      1     11     12      11      2</div><div class="line">##      blocks turnovers fouls points plusminus year</div><div class="line">##   1:      0         4     1     23         2 2009</div><div class="line">##   2:      0         4     1     14        19 2009</div><div class="line">##   3:      0         4     0     27         5 2009</div><div class="line">##   4:      0         7     3     33         8 2009</div><div class="line">##   5:      0         4     2     36         7 2009</div><div class="line">##  ---                                             </div><div class="line">## 536:      4         3     1     43        -5 2010</div><div class="line">## 537:      4         3     2     24        19 2010</div><div class="line">## 538:      4         4     2     27        -3 2008</div><div class="line">## 539:      4         3     0     27       -18 2007</div><div class="line">## 540:      4         2     5     43         5 2006</div></pre></td></tr></table></figure>
<h3 id="选择分组"><a href="#选择分组" class="headerlink" title="选择分组"></a>选择分组</h3><h3 id="Rolling-joins"><a href="#Rolling-joins" class="headerlink" title="Rolling joins"></a>Rolling joins</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">setkey(dtb.key, blocks)</div><div class="line">dtb.key[.(15), roll=TRUE]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">##          date      game_id team_home_abbr team       player player_id</div><div class="line">## 1: 2011-03-15 201103150CHI            CHI  WAS JaVale McGee mcgeeja01</div><div class="line">##    minutes fgm fga 3pm 3pa ftm fta offreb defreb totreb assists steals</div><div class="line">## 1:   39.37   5  14   0   0   1   3      3      9     12       1      0</div><div class="line">##    blocks turnovers fouls points plusminus year</div><div class="line">## 1:     15         2     4     11       -15 2011</div></pre></td></tr></table></figure>
<h2 id="其他data-table函数"><a href="#其他data-table函数" class="headerlink" title="其他data.table函数"></a>其他<code>data.table</code>函数</h2><h3 id="fread-快速读取"><a href="#fread-快速读取" class="headerlink" title="fread()快速读取"></a><code>fread()</code>快速读取</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># Borrowed from data.table document:</div><div class="line">n=1e6</div><div class="line">DT = data.table( a=sample(1:1000,n,replace=TRUE),</div><div class="line">                 b=sample(1:1000,n,replace=TRUE),</div><div class="line">                 c=rnorm(n),</div><div class="line">                 d=sample(c(&quot;foo&quot;,&quot;bar&quot;,&quot;baz&quot;,&quot;qux&quot;,&quot;quux&quot;),n,replace=TRUE),</div><div class="line">                 e=rnorm(n),</div><div class="line">                 f=sample(1:1000,n,replace=TRUE) )</div><div class="line">DT[2,b:=NA_integer_]</div><div class="line">DT[4,c:=NA_real_]</div><div class="line">DT[3,d:=NA_character_]</div><div class="line">DT[5,d:=&quot;&quot;]</div><div class="line">DT[2,e:=+Inf]</div><div class="line">DT[3,e:=-Inf]</div><div class="line">write.table(DT,&quot;test.csv&quot;,sep=&quot;,&quot;,row.names=FALSE,quote=FALSE)</div><div class="line">cat(&quot;File size (MB):&quot;, round(file.info(&quot;test.csv&quot;)$size/1024^2),&quot;\n&quot;)</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">## File size (MB): 50</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">system.time(DF1 &lt;-read.csv(&quot;test.csv&quot;,stringsAsFactors=FALSE))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">##    user  system elapsed </div><div class="line">##  13.518   0.290  14.087</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">system.time(DF2 &lt;- read.table(&quot;test.csv&quot;,header=TRUE,sep=&quot;,&quot;,quote=&quot;&quot;,</div><div class="line">                              stringsAsFactors=FALSE,comment.char=&quot;&quot;,nrows=n,</div><div class="line">                              colClasses=c(&quot;integer&quot;,&quot;integer&quot;,&quot;numeric&quot;,</div><div class="line">                                           &quot;character&quot;,&quot;numeric&quot;,&quot;integer&quot;)))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">##    user  system elapsed </div><div class="line">##   7.553   0.107   7.908</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">system.time(DT &lt;- fread(&quot;test.csv&quot;))</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">##    user  system elapsed </div><div class="line">##   0.627   0.026   0.657</div></pre></td></tr></table></figure>
</div></article></div></section><footer><div class="paginator"><a href="/2015/11/09/技术/2015-11-09-Read-rows-col/" class="prev"><button class="ui button teal">PREV</button></a><a href="/2015/11/02/技术/2015-11-02-data-table/" class="next"><button class="ui button teal">NEXT</button></a></div><div data-thread-key="2015/11/02/技术/2015-11-02-data-table2/" data-title="data.table Way2" data-url="http://shichangshun.cn/2015/11/02/技术/2015-11-02-data-table2/" class="ds-share"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><span class="ds-more">分享到：</span></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul></div></div><div data-thread-key="2015/11/02/技术/2015-11-02-data-table2/" data-title="data.table Way2" data-url="http://shichangshun.cn/2015/11/02/技术/2015-11-02-data-table2/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"changshun"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2018 <a href="http://shichangshun.cn">Changshun</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and theme by <a href="https://github.com/littlewin-wang/hexo-theme-casual" target="_blank">casual</a></p></div></footer></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script><script src="/js/jquery.scrollex.js"></script><script src="/js/jquery.goup.min.js"></script><script src="/js/semantic.min.js"></script><script src="/js/casual.js"></script><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>$(document).ready(function(){$.goup({trigger:100,bottomOffset:100,locationOffset: 0,title:'',titleAsText:true});});</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','TvAnFS4AVxjiJUvrZJRB','2.0.0');</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></div></body></html>